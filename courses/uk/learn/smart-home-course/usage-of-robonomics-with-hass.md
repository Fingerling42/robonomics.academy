---
title: "Урок №7, Використання Robonomics з Home Assistant"
lastUpdate: Thu May 18 2023 10:46:29 GMT+0400 (Samara Standard Time)
description: курс домашнього асистента
lessonNumber: 8
metaOptions: [Вивчайте, Суверенний Розумний Дім з Robonomics та Домашнім Асистентом]
defaultName: Sovereign Smart Home with Robonomics and Home Assistant
---

## Про що йдеться

У цьому уроці ви спробуєте використати основні IoT-сервіси Robonomics. Перший може запитувати телеметрію розумних пристроїв для дому, що дозволяє вам отримувати дані з Home Assistant віддалено. Другий сервіс генерує резервні копії конфігурації вашого Home Assistant і відновлює її за потреби (наприклад, у випадку відмови SD-карт).


## Про функції парачейну

Далі ви побачите, як використовуються функції парачейну Robonomics для надання користувачу Home Assistant необхідного сервісу. 

Отримання телеметрії базується на палітрі <code>datalog</code>, яку ви вже знаєте. Кожен певний період часу (але не рідше, ніж дозволяє накопичена вага), транзакція <code>datalog.record()</code> відправляється на парачейн з адреси <code>SUB_CONTROLLER</code> з IPFS-хешем зашифрованого файлу, де збираються всі дані вашого IoT-пристрою. Фактично, для отримання телеметрії ви запитуєте необхідні журнали даних від парачейну, пов'язані з вашою підпискою на IoT, а потім розшифровуєте їх за допомогою своїх ключів.

Для створення резервної копії використовується інша палітра Robonomics під назвою <code>digitalTwin</code>, яка є реалізацією ідеї цифрового близнюка, цифрової версії реального обладнання, яка копіює його технічні характеристики та історичні дані. Спочатку для цифрового близнюка вашого Home Assistant створюється унікальний ідентифікатор за допомогою екстриксу <code>digitalTwin.create()</code>. Потім, використовуючи екстрикс <code>digitalTwin.setSource()</code>, цей ідентифікатор пов'язується з певними даними (поле <code>topic</code>) та з адресою на парачейні (поле <code>source</code>). Для резервного копіювання Home Assistant хеш файлу резервної копії зберігається в полі <code>topic</code>, а адреса <code>SUB_OWNER</code> зберігається в полі <code>source</code>.

## Інструкції

<List type="numbers">

<li>

Отримання телеметрії

<List>


<li>

Перейдіть до додатку та виберіть [Телеметрія розумного будинку](https://dapp.robonomics.network/#/smarthome-telemetry) сервіс.

<LessonVideo  :videos="[{src: 'https://crustipfs.info/ipfs/Qmao9RoWcKo2qs4PAGtm5gqHzyAHJcpDqNLgciU35FJeVm', type:'mp4'}]" />

</li>

<li>

У полі <code>CONTROLLER</code> введіть адресу <code>SUB_CONTROLLER</code>. Вставте фразу для шифрування даних.

</li>

<li>

У блоку <code>Отримати телеметрію</code> виберіть мітку часу зі списку та натисніть кнопку <code>ЗАВАНТАЖИТИ ТЕЛЕМЕТРІЮ</code>.


Завантаження телеметрії може зайняти деякий час. Після завершення ви побачите інформацію з ваших датчиків.

</li>
</List>
</li>


<li>

Створення резервної копії

<List>

<li>

Для створення резервних копій викликається сервіс, який генерує захищений рхів з файлами конфігурації. Потім цей сервіс додає архів до IPFS та зберігає отриманий CID в Robonomics Digital Twin.

<robo-academy-note type="warning" title="WARNING">
Для відновлення конфігурації необхідно використовувати власний шлюз IPFS, такий як Pinata (pinata.cloud) або Crust Network (crust.network). Без цього ваша резервна копія буде зберігатися виключно на вашому локальному вузлі IPFS, що може завадити відновленню конфігурації Home Assistant у разі відмови локального вузла. 
</robo-academy-note>

<LessonVideo  :videos="[{src: 'https://crustipfs.info/ipfs/QmVo91dLaAYgFDM1vrL2PYfAffM6SGGC59ZERbfHR44tqW', type:'mp4'}]" />

</li>

<li>

У веб-інтерфейсі Home Assistant перейдіть до <code>Інструменти розробника</code> -> <code>Сервіси</code>. Знайдіть <code>Robonomics: Зберегти резервну копію в Robonomics</code> та натисніть <code>ВИКЛИКАТИ СЕРВІС</code>.

</li>

<li>

Зачекайте, доки ви не побачите сповіщення <code>Резервна копія була оновлена в Robonomics</code> у розділі <code>Сповіщення</code>.

</li>

<li>

Для відновлення конфігурації вам потрібно буде встановити новий екземпляр Home Assistant (і повторити всі попередні кроки) з інтеграцією Robonomics Home Assistant, використовуючи ті самі seed-фрази, які ви створили раніше. Вам також потрібно буде налаштувати брокер MQTT з тим самим ім'ям користувача та паролем.

<robo-academy-note type="warning" title="WARNING">
Оскільки деякі пристрої, підключені до Home Assistant через Wi-Fi або MQTT, вимагають явного вказання локальної IP-адреси вашого Raspberry Pi, при відновленні резервної копії вони можуть бути недоступні через зміну цієї IP-адреси. Вам потрібно буде ввести нову IP-адресу в налаштування цих пристроїв. Щоб уникнути цього, ви можете налаштувати статичну локальну IP-адресу для вашого Raspberry Pi в налаштуваннях вашого маршрутизатора (якщо він підтримує цю функцію).
</robo-academy-note>

<LessonVideo  :videos="[{src: 'https://crustipfs.info/ipfs/QmWmnmkXUcPXsAnQzwN3UEuki2GMYnQDx3vhgjEypCU8aR', type:'mp4'}]" />


</li>

<li>

У веб-інтерфейсі Home Assistant перейдіть до <code>Інструменти розробника</code> -> <code>Сервіси</code>. Знайдіть <code>Robonomics: Відновити з резервної копії в Robonomics</code> та натисніть <code>ВИКЛИКАТИ СЕРВІС</code>. Перейдіть на сторінку <code>Огляд</code>, щоб перевірити статус вашої резервної копії.

</li>

<li>

Після завершення перезапуску Home Assistant ваша конфігурація буде відновлена. Якщо статус зміниться на <code>відновлено</code>, але Home Assistant не переапускається автоматично, вам потрібно буде вручну перезапустити його, перейшовши до <code>Налаштування</code> > <code>Система</code> та натиснувши кнопку <code>ПЕРЕЗАПУСК</code> у верхньому правому куті.

</li>

</List>
</li>

</List>

## Завершення курсу

<List>

<li class="flex"> 

Вітання! Ви успішно завершили повне налаштування та розгортання вашого суверенного розумного будинку. Тепер ви можете запросити сертифікат про завершення курсу від нас, відвідавши наш Discord-канал. Напишіть нам в чаті [robonomics-academy](https://discord.com/channels/803947358492557312/803947358492557315), і наш представник зв'яжеться з вами.
</li>

<li class="flex">

Доказом завершення курсу є відповідні транзакції, які можна перевірити в [Polkadot explorer](https://robonomics.subscan.io/). Це транзакції про покупку підписки, додавання пристрою до підписки та відправлення даних з пристроїв.

</li>

</List>