---
title: "Урок №7, Использование Robonomics с Home Assistant"
lastUpdate: Thu May 18 2023 10:46:29 GMT+0400 (Samara Standard Time)
description: курс домашнего помощника
lessonNumber: 8
metaOptions: [Изучите суверенный умный дом с помощью Robonomics и Home Assistant]
defaultName: Sovereign Smart Home with Robonomics and Home Assistant
---

## О чем это

В этом уроке вы попробуете использовать основные IoT-сервисы Robonomics. Первый из них может запрашивать телеметрию умных устройств дома, позволяя вам удаленно получать данные из Home Assistant. Второй сервис создает резервные копии конфигурации вашего Home Assistant и восстанавливает ее при необходимости (например, в случае отказа SD-карт).


## О функциях парачейна

Далее вы увидите, как используются функции парачейна Robonomics для предоставления пользователю Home Assistant необходимого сервиса. 

Получение телеметрии основано на палитре <code>datalog</code>, которую вы уже знаете. Каждый определенный период времени (но не реже, чем позволяет накопленный вес), транзакция <code>datalog.record()</code> отправляется на парачейн с адреса <code>SUB_CONTROLLER</code> с IPFS-хешем зашифрованного файла, в котором собраны все данные ваших IoT-устройств. Фактически, чтобы получить телеметрию, вы запрашиваете необходимые журналы данных из парачейна, связанные с вашей подпиской на IoT, а затем расшифровываете их с помощью ваших ключей.

Для создания резервной копии используется другая палитра Robonomics под названием <code>digitalTwin</code>, которая является реализацией идеи цифрового двойника, цифровой версии реального оборудования, копирующей его технические характеристики и исторические данные. Сначала создается уникальный идентификатор для цифрового двойника вашего Home Assistant с помощью экстракта <code>digitalTwin.create()</code>. Затем, используя экстракт <code>digitalTwin.setSource()</code>, этот идентификатор привязывается к некоторым данным (поле <code>topic</code>) и к адресу в парачейне (поле <code>source</code>). Для резервного копирования Home Assistant хеш резервного файла хранится в <code>topic</code>, а адрес <code>SUB_OWNER</code> хранится в <code>source</code>].

## Инструкции

<List type="numbers">

<li>

Получение телеметрии

<List>


<li>

Перейдите на dapp и выберите [SmartHome Telemetry](https://dapp.robonomics.network/#/smarthome-telemetry) сервис.

<LessonVideo  :videos="[{src: 'https://crustipfs.info/ipfs/Qmao9RoWcKo2qs4PAGtm5gqHzyAHJcpDqNLgciU35FJeVm', type:'mp4'}]" />

</li>

<li>

В поле <code>CONTROLLER</code> введите адрес <code>SUB_CONTROLLER</code>. Вставьте фразу-семя для шифрования данных.

</li>

<li>

В блоке <code>Get telemetry</code> выберите временную метку из выпадающего списка и нажмите кнопку <code>DOWNLOAD TELEMETRY</code>.


Загрузка телеметрии может занять некоторое время. По завершении вы увидите информацию с ваших датчиков.

</li>
</List>
</li>


<li>

Создание резервной копии

<List>

<li>

Для создания резервных копий вызывается сервис, который генерирует защищенный архив с файлами конфигурации. Затем этот сервис добавляет архив в IPFS и сохраняет полученный CID в Robonomics Digital Twin.

<robo-academy-note type="warning" title="WARNING">
Для восстановления вашей конфигурации необходимо использовать пользовательский шлюз IPFS, такой как Pinata (pinata.cloud) или Crust Network (crust.network). Без этого ваша резервная копия будет храниться исключительно на вашем локальном узле IPFS, что может помешать восстановлению конфигурации Home Assistant в случае отказа локального узла. 
</robo-academy-note>

<LessonVideo  :videos="[{src: 'https://crustipfs.info/ipfs/QmVo91dLaAYgFDM1vrL2PYfAffM6SGGC59ZERbfHR44tqW', type:'mp4'}]" />

</li>

<li>

В веб-интерфейсе Home Assistant перейдите в <code>Инструменты разработчика</code> -> <code>Сервисы</code>. Найдите <code>Robonomics: Сохранить резервную копию в Robonomics</code> и нажмите <code>ВЫЗВАТЬ СЕРВИС</code>.

</li>

<li>

Дождитесь появления уведомления <code>Резервная копия обновлена в Robonomics</code> в разделе <code>Уведомления</code>.

</li>

<li>

Для восстановления конфигурации вам потребуется установить новый экземпляр Home Assistant (и повторить все предыдущие шаги) с интеграцией Robonomics Home Assistant, используя те же сиды, которые вы создали ранее. Вам также потребуется настроить брокер MQTT с тем же именем пользователя и паролем.

<robo-academy-note type="warning" title="WARNING">
Поскольку некоторые устройства, подключенные к Home Assistant через Wi-Fi или MQTT, требуют явного указания локального IP-адреса вашего Raspberry Pi, при восстановлении резервной копии они могут быть недоступны из-за изменения этого IP. Вам нужно будет повторно ввести новый IP-адрес в настройках этих устройств. Чтобы избежать этого, вы можете настроить статический локальный IP для вашего Raspberry Pi в настройках вашего маршрутизатора (если он поддерживает эту функцию).
</robo-academy-note>

<LessonVideo  :videos="[{src: 'https://crustipfs.info/ipfs/QmWmnmkXUcPXsAnQzwN3UEuki2GMYnQDx3vhgjEypCU8aR', type:'mp4'}]" />


</li>

<li>

В веб-интерфейсе Home Assistant перейдите в <code>Инструменты разработчика</code> -> <code>Сервисы</code>. Найдите <code>Robonomics: Восстановить из резервной копии в Robonomics</code> и нажмите <code>ВЫЗВАТЬ СЕРВИС</code>. Перейдите на страницу <code>Обзор</code>, чтобы проверить статус вашей резервной копии.

</li>

<li>

Как только Home Assistant закончит перезагрузку, ваша конфигурация будет восстановлена. Если статус изменится на <code>восстановлен</code>, но Home Assistant не перезапустится автоматически, вам нужно будет вручную перезапустить его, перейдя в <code>Настройки</code> > <code>Система</code> и нажав на кнопку <code>ПЕРЕЗАГРУЗИТЬ</code> в правом верхнем углу.

</li>

</List>
</li>

</List>

## Завершение курса

<List>

<li class="flex"> 

Поздравляем! Вы успешно завершили полную настройку и развертывание вашего суверенного умного дома. Теперь вы можете запросить у нас сертификат о завершении курса, посетив наш Discord-канал. Напишите нам в чат [robonomics-academy](https://discord.com/channels/803947358492557312/803947358492557315) и наш представитель свяжется с вами.
</li>

<li class="flex">

Доказательством завершения курса являются соответствующие транзакции, которые можно проверить в [Полкадот-эксплорере](https://robonomics.subscan.io/). Это транзакции о покупке подписки, добавлении устройства к подписке и отправке журналов данных с устройств.

</li>

</List>